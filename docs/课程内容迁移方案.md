# 深海圈课程内容迁移方案

## 📋 课程内容类型映射

### 1. 图文内容（原WordPress文章）
```javascript
// 原来：WordPress公开链接
https://wordpress.com/这套课程有什么不同

// 迁移后：私有存储 + 权限验证
/api/protected-content/preface/lesson1.html
```

### 2. 视频内容
```javascript
// 原来：可能存在YouTube或其他平台
https://youtube.com/watch?v=xxx

// 迁移后：私有COS存储
/api/protected-content/preface/videos/lesson3-env-setup.mp4
```

### 3. 作业/练习文件
```javascript
// 原来：可能是公开下载链接
https://example.com/homework.pdf

// 迁移后：需要权限才能下载
/api/protected-content/preface/homework/exercise1.pdf
```

## 🚀 实施步骤

### 第一步：创建课程内容管理页面

创建 `/app/admin/courses/content-manager/page.tsx`：

```typescript
'use client';

import { useState } from 'react';
import { FileText, Video, FileCode, Upload } from 'lucide-react';

export default function CourseContentManager() {
  const [selectedLesson, setSelectedLesson] = useState(null);
  
  const lessons = [
    {
      id: 'lesson1',
      title: '这套课程有什么不同？',
      type: 'article',
      hasContent: true,
      contentTypes: ['text', 'images']
    },
    {
      id: 'lesson2',
      title: '学习路径介绍',
      type: 'mixed',
      hasContent: false,
      contentTypes: ['text', 'images', 'pdf']
    },
    {
      id: 'lesson3',
      title: '开发环境准备',
      type: 'video',
      hasContent: false,
      contentTypes: ['video', 'text', 'code']
    }
  ];

  return (
    <div className="max-w-6xl mx-auto p-6">
      <h1 className="text-2xl font-bold mb-6">课程内容管理</h1>
      
      <div className="grid grid-cols-3 gap-6">
        {/* 课程列表 */}
        <div className="bg-white rounded-lg shadow p-4">
          <h2 className="font-semibold mb-4">课程章节</h2>
          {lessons.map(lesson => (
            <div
              key={lesson.id}
              onClick={() => setSelectedLesson(lesson)}
              className={`p-3 rounded cursor-pointer mb-2 flex items-center justify-between
                ${selectedLesson?.id === lesson.id ? 'bg-blue-50 border-blue-500 border' : 'hover:bg-gray-50'}`}
            >
              <div className="flex items-center gap-2">
                {lesson.type === 'article' && <FileText className="w-4 h-4" />}
                {lesson.type === 'video' && <Video className="w-4 h-4" />}
                {lesson.type === 'mixed' && <FileCode className="w-4 h-4" />}
                <span className="text-sm">{lesson.title}</span>
              </div>
              {lesson.hasContent && (
                <span className="text-xs bg-green-100 text-green-700 px-2 py-1 rounded">已上传</span>
              )}
            </div>
          ))}
        </div>

        {/* 内容上传区 */}
        <div className="col-span-2 bg-white rounded-lg shadow p-6">
          {selectedLesson ? (
            <div>
              <h3 className="font-semibold mb-4">{selectedLesson.title}</h3>
              
              {/* 根据课程类型显示不同的上传选项 */}
              <div className="space-y-4">
                {selectedLesson.contentTypes.includes('text') && (
                  <div className="border-2 border-dashed rounded-lg p-4">
                    <h4 className="font-medium mb-2">文本内容</h4>
                    <button className="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">
                      从WordPress导入
                    </button>
                  </div>
                )}
                
                {selectedLesson.contentTypes.includes('video') && (
                  <div className="border-2 border-dashed rounded-lg p-4">
                    <h4 className="font-medium mb-2">视频内容</h4>
                    <input type="file" accept="video/*" className="mb-2" />
                    <p className="text-sm text-gray-500">支持 MP4, MOV 等格式</p>
                  </div>
                )}
                
                {selectedLesson.contentTypes.includes('pdf') && (
                  <div className="border-2 border-dashed rounded-lg p-4">
                    <h4 className="font-medium mb-2">作业/资料</h4>
                    <input type="file" accept=".pdf,.doc,.docx" className="mb-2" />
                    <p className="text-sm text-gray-500">支持 PDF, Word 文档</p>
                  </div>
                )}
              </div>
            </div>
          ) : (
            <div className="text-center text-gray-500 py-12">
              <Upload className="w-12 h-12 mx-auto mb-4 text-gray-300" />
              <p>选择一个课程开始上传内容</p>
            </div>
          )}
        </div>
      </div>
    </div>
  );
}
```

### 第二步：迁移WordPress内容

运行迁移脚本，将WordPress内容转移到私有存储：

```bash
node scripts/migrate-from-wordpress.js
```

### 第三步：更新课程数据

在 `/lib/course-data.ts` 中更新课程信息：

```typescript
{
  id: 'preface-1',
  title: '这套课程有什么不同?',
  slug: 'intro',
  type: 'protected', // 改为protected类型
  contentKey: 'courses/preface/lesson1/content.html', // COS中的路径
  videoKey: null,
  homeworkKey: null,
  duration: '10分钟',
  order: 1,
  isFree: false, // 付费内容
}
```

### 第四步：在课程详情页显示

修改 `LessonContent` 组件支持私有内容：

```jsx
{lesson.type === 'protected' && (
  <div className="prose prose-lg max-w-none">
    <ProtectedContent 
      courseId={courseId}
      contentKey={lesson.contentKey}
    />
  </div>
)}
```

## 🎯 最终效果

1. **学员访问课程** → 需要登录
2. **点击"这套课程有什么不同？"** → 检查是否购买
3. **已购买** → 从私有COS加载内容
4. **未购买** → 提示购买课程

## 💡 优势

- ✅ 完全替代WordPress，解决公开链接问题
- ✅ 支持所有内容类型（图文、视频、作业）
- ✅ 统一的权限管理
- ✅ 内容完全私有化保护