# 用户学习进度追踪系统

## 数据库设计

### 1. 用户进度表 (user_progress)
```sql
CREATE TABLE user_progress (
  id          INTEGER PRIMARY KEY,
  user_id     INTEGER,      -- 用户ID
  lesson_id   INTEGER,      -- 课时ID
  status      VARCHAR(20),  -- 'not_started', 'in_progress', 'completed'
  progress    INTEGER,      -- 进度百分比 (0-100)
  started_at  DATETIME,     -- 开始学习时间
  completed_at DATETIME,    -- 完成时间
  last_position INTEGER,    -- 视频最后播放位置（秒）
  notes       TEXT          -- 学习笔记
);
```

### 2. 学习记录表 (learning_logs)
```sql
CREATE TABLE learning_logs (
  id          INTEGER PRIMARY KEY,
  user_id     INTEGER,
  lesson_id   INTEGER,
  action      VARCHAR(50),  -- 'start', 'pause', 'complete', 'review'
  duration    INTEGER,      -- 学习时长（秒）
  created_at  DATETIME
);
```

## 功能实现

### 1. 获取用户课程状态
```typescript
// API: /api/users/[userId]/course-progress
async function getUserCourseProgress(userId: string) {
  // 获取所有课程
  const allLessons = await getAllLessons();
  
  // 获取用户进度
  const userProgress = await prisma.userProgress.findMany({
    where: { userId }
  });
  
  // 合并数据
  return allLessons.map(lesson => ({
    ...lesson,
    status: userProgress.find(p => p.lessonId === lesson.id)?.status || 'not_started',
    progress: userProgress.find(p => p.lessonId === lesson.id)?.progress || 0
  }));
}
```

### 2. 更新学习进度
```typescript
// 记录视频播放进度
async function updateVideoProgress(userId: string, lessonId: string, position: number, duration: number) {
  const progress = Math.floor((position / duration) * 100);
  
  await prisma.userProgress.upsert({
    where: { userId_lessonId: { userId, lessonId } },
    update: { 
      progress,
      lastPosition: position,
      status: progress >= 90 ? 'completed' : 'in_progress'
    },
    create: {
      userId,
      lessonId,
      progress,
      lastPosition: position,
      status: 'in_progress',
      startedAt: new Date()
    }
  });
}
```

### 3. 页面显示
```typescript
// 课程列表页面
function CoursePage() {
  const { data: userProgress } = useUserProgress();
  
  return (
    <div>
      {sections.map(section => (
        <div key={section.id}>
          <h3>{section.title}</h3>
          <div className="text-sm text-gray-600">
            完成 {userProgress[section.id].completed}/{userProgress[section.id].total} 课时
          </div>
          <ProgressBar value={userProgress[section.id].percentage} />
        </div>
      ))}
    </div>
  );
}
```

## 特色功能

### 1. 学习连续天数
```typescript
// 显示学习打卡
<div className="flex items-center gap-2">
  <Flame className="text-orange-500" />
  <span>连续学习 {streak} 天</span>
</div>
```

### 2. 学习时长统计
```typescript
// 今日学习时长
<div className="stats-card">
  <Clock className="w-5 h-5" />
  <div>
    <p className="text-sm">今日学习</p>
    <p className="text-2xl font-bold">{formatDuration(todayDuration)}</p>
  </div>
</div>
```

### 3. 智能推荐下一课
```typescript
// 根据学习进度推荐
const nextLesson = getNextRecommendedLesson(userProgress);
```

## 实现步骤

1. **第一步**：创建数据库表
2. **第二步**：实现进度记录 API
3. **第三步**：在课程页面集成进度显示
4. **第四步**：添加视频播放进度追踪
5. **第五步**：实现学习统计页面