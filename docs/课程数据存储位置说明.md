# 深海圈课程数据存储位置说明

## 一、服务器信息

- **服务器类型**：腾讯云轻量应用服务器
- **服务器IP**：111.231.19.162
- **操作系统**：OpenCloudOS
- **管理面板**：宝塔面板

## 二、数据库信息

### 基本信息
- **数据库类型**：PostgreSQL 14.10
- **数据库名称**：deepsea
- **数据库用户**：postgres
- **数据库位置**：`/www/server/pgsql/data/`
- **连接端口**：5432

### 数据库管理
- 通过宝塔面板 → 数据库 → PgSQL 管理
- 通过SSH终端直接连接

## 三、数据表结构

### 主要数据表

1. **CourseSection** - 大章节表
   - 存储：前言、基础篇、认知篇、内功篇、进阶篇、问答等

2. **Course** - 课程表
   - 存储：每个章节下的具体课程

3. **Chapter** - 章节表
   - 存储：课程内的章节划分

4. **Lesson** - 课时表（核心数据表）
   - `id`: 唯一标识
   - `title`: 课时标题
   - `type`: 课时类型（VIDEO_TEXT/TEXT_ONLY）
   - `videoId`: 腾讯云VOD视频ID
   - `content`: 课程文字内容（支持Markdown）
   - `createdAt`: 创建时间
   - `updatedAt`: 更新时间

## 四、已存储数据示例

```
课时ID: cmds7jmy10001ccjcye7jax29
课时标题: 视频教学
视频ID: 1371032577/813c486b5145403693546602968
存储时间: 2025-08-01
```

## 五、数据验证方式

### 1. SSH登录服务器
```bash
ssh root@111.231.19.162
```

### 2. 连接数据库
```bash
/www/server/pgsql/bin/psql -U postgres -d deepsea
```

### 3. 常用查询命令

查看所有表：
```sql
\dt
```

查询视频课程：
```sql
SELECT id, title, "videoId" FROM "Lesson" WHERE "videoId" IS NOT NULL ORDER BY "createdAt" DESC;
```

查询课程结构：
```sql
SELECT 
    cs.title as "章节",
    c.title as "课程",
    l.title as "课时",
    l.type as "类型",
    CASE WHEN l."videoId" IS NOT NULL THEN '有视频' ELSE '无视频' END as "视频状态"
FROM "CourseSection" cs
JOIN "Course" c ON cs.id = c."sectionId"
JOIN "Chapter" ch ON c.id = ch."courseId"
JOIN "Lesson" l ON ch.id = l."chapterId"
ORDER BY cs."order", c."order", l."order";
```

统计数据：
```sql
SELECT 
    COUNT(DISTINCT cs.id) as "章节总数",
    COUNT(DISTINCT c.id) as "课程总数",
    COUNT(DISTINCT l.id) as "课时总数",
    COUNT(DISTINCT CASE WHEN l."videoId" IS NOT NULL THEN l.id END) as "视频课时数"
FROM "CourseSection" cs
JOIN "Course" c ON cs.id = c."sectionId"
JOIN "Chapter" ch ON c.id = ch."courseId"
JOIN "Lesson" l ON ch.id = l."chapterId";
```

### 4. 退出数据库
```sql
\q
```

## 六、访问路径

- **管理后台**：http://111.231.19.162:3000/admin/courses/content
- **课程前台**：http://111.231.19.162:3000/courses
- **宝塔面板**：http://111.231.19.162:8888

## 七、在宝塔面板查看

1. 登录宝塔面板
2. 点击"数据库" → "PgSQL"
3. 可以看到 `deepsea` 数据库
4. 点击"终端"可以执行上述SQL命令

## 八、备份说明

- 数据库自动备份：通过宝塔面板设置
- 手动备份命令：
  ```bash
  pg_dump -U postgres deepsea > /www/backup/database/deepsea_$(date +%Y%m%d).sql
  ```

---

**更新时间**：2025年8月1日

**说明**：本文档用于记录深海圈网站课程数据的存储位置和访问方式，方便团队成员了解数据架构。