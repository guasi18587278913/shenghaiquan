# 删除多余用户 - 恢复到905个用户

## 步骤1：创建删除脚本

复制下面的整段代码到宝塔终端：

```bash
cat > scripts/remove-extra-users.js << 'EOF'
const { PrismaClient } = require('@prisma/client');
const prisma = new PrismaClient();

async function removeExtraUsers() {
  try {
    // 获取所有用户，按创建时间排序
    const allUsers = await prisma.user.findMany({
      orderBy: { createdAt: 'desc' },
      select: { id: true, name: true, createdAt: true, phone: true }
    });
    
    console.log(`总用户数: ${allUsers.length}`);
    
    if (allUsers.length <= 905) {
      console.log('用户数已经是905或更少，无需删除');
      return;
    }
    
    // 要删除的用户数
    const toDelete = allUsers.length - 905;
    console.log(`需要删除最新的 ${toDelete} 个用户`);
    
    // 获取要删除的用户ID
    const userIdsToDelete = allUsers.slice(0, toDelete).map(u => u.id);
    
    console.log('即将删除以下用户:');
    allUsers.slice(0, 5).forEach(u => {
      console.log(`- ${u.name} (${u.phone || '无手机号'})`);
    });
    console.log('...');
    
    // 确认删除
    console.log('\n执行删除...');
    
    // 批量删除
    const result = await prisma.user.deleteMany({
      where: {
        id: { in: userIdsToDelete }
      }
    });
    
    console.log(`✅ 成功删除 ${result.count} 个用户`);
    
    // 验证最终用户数
    const finalCount = await prisma.user.count();
    console.log(`最终用户数: ${finalCount}`);
    
  } catch (error) {
    console.error('删除失败:', error);
  } finally {
    await prisma.$disconnect();
  }
}

removeExtraUsers();
EOF
```

## 步骤2：运行删除脚本

```bash
node scripts/remove-extra-users.js
```

## 步骤3：验证结果

```bash
node -e "
const { PrismaClient } = require('@prisma/client');
const prisma = new PrismaClient();
prisma.user.count().then(count => {
  console.log('删除后用户数：', count);
  process.exit(0);
});
"
```

---

## 预期结果

- 删除前：1560个用户
- 删除后：905个用户
- 删除数量：655个用户

## 注意事项

1. 确保在项目目录 `/www/wwwroot/deepsea` 中执行
2. 这个脚本会删除最新创建的655个用户
3. 删除操作不可恢复，请确认后再执行