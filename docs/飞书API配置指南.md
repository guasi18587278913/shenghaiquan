# 飞书API配置指南

## 1. 创建飞书应用

1. 访问 [飞书开放平台](https://open.feishu.cn/)
2. 登录你的飞书账号
3. 进入"开发者后台" → "创建应用"
4. 选择"企业自建应用"
5. 填写应用信息：
   - 应用名称：深海圈课程导入
   - 应用描述：用于导入飞书文档到课程系统

## 2. 获取应用凭证

创建应用后，在应用详情页面：
1. 进入"凭证与基础信息"
2. 复制以下信息：
   - App ID
   - App Secret

## 3. 配置应用权限

在应用详情页面：
1. 进入"权限管理"
2. 添加以下权限：
   - `docx:document:readonly` - 查看新版文档
   - `drive:drive:readonly` - 查看云空间文件
   - `drive:file:read` - 读取文件内容

## 4. 配置环境变量

在项目根目录创建或编辑 `.env.local` 文件：

```bash
# 飞书API配置
FEISHU_APP_ID=cli_xxxxxxxxxxxxxxxxx
FEISHU_APP_SECRET=xxxxxxxxxxxxxxxxxxxxxxxxxxxxx
```

## 5. 获取文档权限

确保要导入的文档满足以下条件之一：
- 文档是公开的
- 文档所在的知识库对应用可见
- 手动将应用添加为文档协作者

### 方法1：添加应用为协作者
1. 打开飞书文档
2. 点击右上角"分享"
3. 添加你的应用（搜索应用名称）
4. 设置权限为"可阅读"

### 方法2：通过知识库授权
1. 进入知识库设置
2. 添加应用权限
3. 所有该知识库下的文档都可访问

## 6. 使用方法

1. 访问：`http://localhost:3000/admin/courses/import-feishu-api`
2. 粘贴飞书文档链接，例如：
   ```
   https://xxx.feishu.cn/docx/ABC123xxxxx
   ```
3. 点击"获取文档"
4. 系统会自动：
   - 获取文档内容
   - 转换格式
   - 下载并上传图片
5. 填写章节和课时信息
6. 保存

## 7. 常见问题

### Q: 获取文档失败
A: 检查：
- App ID 和 Secret 是否正确
- 应用是否有文档读取权限
- 文档是否对应用可见

### Q: 图片无法显示
A: 确保应用有 `drive:file:read` 权限

### Q: 找不到应用
A: 在飞书中搜索时，使用应用的完整名称

## 8. 进阶配置

### 批量导入
可以修改代码支持：
- 导入整个知识库
- 批量处理多个文档
- 自动创建章节结构

### 格式优化
支持更多飞书文档元素：
- 表格
- 多级列表
- 引用块
- 任务列表

需要帮助？查看 `/lib/feishu-api.ts` 了解详细实现。