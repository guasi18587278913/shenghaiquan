# 修复网站构建问题

## 问题描述
Next.js 构建文件缺失，导致网站无法正常运行。主要错误：
- `.next` 目录下的关键文件缺失
- Prisma 客户端未生成
- 路由清单文件丢失

## 修复步骤

### 1. 停止所有 Next.js 进程
```bash
kill -9 $(ps aux | grep "next dev" | grep -v grep | awk '{print $2}')
```

### 2. 清理构建文件和缓存
```bash
rm -rf .next
rm -rf node_modules/.cache
```

### 3. 生成 Prisma 客户端
```bash
npx prisma generate --schema=./prisma/schema.prisma
```

### 4. 启动开发服务器
```bash
npm run dev
```

## 备用方案（如果上述步骤失败）

### 备用方案 A：跳过验证启动
```bash
# 清理
rm -rf .next

# 设置环境变量
export SKIP_ENV_VALIDATION=true

# 启动
npx next dev
```

### 备用方案 B：创建最小化结构
```bash
# 创建目录
mkdir -p .next/server/app
mkdir -p .next/server/pages

# 创建路由清单
echo '{"version":3,"pages404":true,"basePath":"","redirects":[],"rewrites":{"beforeFiles":[],"afterFiles":[],"fallback":[]},"headers":[],"dynamicRoutes":[],"staticRoutes":[],"dataRoutes":[],"i18n":null}' > .next/routes-manifest.json

# 启动
npm run dev
```

## 验证修复

修复完成后，访问以下地址验证：
- 首页：http://localhost:3000
- 地图页：http://localhost:3000/map
- API测试：http://localhost:3000/api/users/locations

## 注意事项

1. 如果遇到 Prisma 生成失败，可能是网络问题，可以尝试：
   ```bash
   npm install @prisma/client --prefer-offline
   ```

2. 如果端口 3000 被占用，会自动使用其他端口（如 3001, 3002 等）

3. 首次启动可能需要较长时间，请耐心等待

## 恢复数据库连接

当网络恢复后，需要恢复真实的数据库连接：

1. 恢复位置数据 API：
   ```bash
   mv app/api/users/locations/route.ts.backup app/api/users/locations/route.ts
   ```

2. 恢复城市用户查询 API：
   ```bash
   mv app/api/users/by-city/route.ts.backup app/api/users/by-city/route.ts
   ```

3. 重新生成 Prisma 客户端：
   ```bash
   npx prisma generate
   ```