# 🚀 立即实施内容保护 - 3步搞定

## 第1步：配置腾讯云COS（10分钟）

### 1.1 创建私有存储桶
```bash
1. 登录腾讯云控制台
2. 进入"对象存储COS"
3. 创建存储桶：
   - 名称：deepsea-private-course
   - 地域：选择离您最近的
   - 访问权限：私有读写 ⚠️重要
```

### 1.2 添加环境变量
在 `.env.local` 添加：
```env
# 私有COS配置
COS_SECRET_ID=你的SecretId
COS_SECRET_KEY=你的SecretKey
COS_PRIVATE_BUCKET=deepsea-private-course
COS_REGION=ap-guangzhou
```

## 第2步：测试内容保护（5分钟）

### 2.1 上传测试内容
```javascript
// 在课程管理页面使用
import { uploadPrivateContent } from '@/lib/content-protection';

const file = // 您的文件
const key = await uploadPrivateContent(
  file,
  'test-lesson.pdf',
  'course-123'
);
```

### 2.2 在课程中显示
```jsx
// 课程详情页
{lesson.type === 'protected' && (
  <iframe 
    src={`/api/protected-content/${courseId}/${lesson.contentKey}`}
    className="w-full h-[600px]"
  />
)}
```

## 第3步：迁移WordPress内容（30分钟）

### 3.1 运行迁移脚本
```bash
# 安装依赖
npm install cos-nodejs-sdk-v5 node-fetch

# 运行迁移
node scripts/migrate-from-wordpress.js
```

### 3.2 更新课程数据
将 WordPress 链接替换为保护链接：
```javascript
// 之前
wordpressSlug: 'your-lesson'

// 之后
type: 'protected',
contentKey: 'courses/migrated/your-lesson/content.html'
```

## ✅ 完成后效果

1. **用户未登录** → 看到"请先登录"
2. **用户未购买** → 看到"请先购买课程"  
3. **已购买用户** → 正常访问内容
4. **链接30分钟后失效** → 需要重新获取

## 🎉 恭喜！您的内容现在安全了

- WordPress的公开链接问题解决了
- 内容存储在私有空间
- 只有付费用户能访问
- 实时权限验证

## 🆘 遇到问题？

1. **COS配置问题**：检查SecretId/Key是否正确
2. **权限验证失败**：确认Enrollment表有数据
3. **内容无法显示**：检查contentKey路径

需要帮助请随时告诉我！