# 服务器手动更新步骤

## 问题诊断
服务器上的代码没有自动更新到最新版本。需要手动执行更新。

## 方法一：通过宝塔面板更新（推荐）

1. **登录宝塔面板**
   ```
   http://111.231.19.162:8888
   ```

2. **进入文件管理器**
   - 点击左侧菜单的"文件"
   - 导航到：`/www/wwwroot/深海圈网站` 或 `/www/wwwroot/shenghaiquan`

3. **打开终端**
   - 在文件管理器中，点击"终端"按钮
   - 或者从左侧菜单选择"终端"

4. **执行更新命令**
   ```bash
   # 进入项目目录
   cd /www/wwwroot/深海圈网站
   
   # 拉取最新代码
   git pull origin main
   
   # 安装依赖（如果有新依赖）
   npm install
   
   # 重新构建
   npm run build
   
   # 重启应用
   pm2 restart shenghaiquan
   ```

## 方法二：SSH 连接更新

如果你有 SSH 权限：

```bash
# 连接服务器
ssh root@111.231.19.162

# 进入项目目录
cd /www/wwwroot/深海圈网站

# 拉取最新代码
git pull origin main

# 安装依赖
npm install

# 构建项目
npm run build

# 查看 PM2 进程
pm2 list

# 重启应用
pm2 restart shenghaiquan

# 查看日志确认启动成功
pm2 logs shenghaiquan --lines 50
```

## 检查更新是否成功

1. **查看 git 状态**
   ```bash
   git log --oneline -5
   ```
   应该看到最新的提交：`集成 Strapi CMS 实现课程内容管理系统`

2. **访问网站验证**
   - 打开：http://111.231.19.162:8888/courses
   - 应该看到新的课程页面设计

## 常见问题

### 1. git pull 失败
如果提示有本地修改冲突：
```bash
# 保存本地修改
git stash

# 拉取更新
git pull origin main

# 恢复本地修改（可选）
git stash pop
```

### 2. npm install 失败
如果依赖安装失败：
```bash
# 清理缓存
npm cache clean --force

# 删除 node_modules
rm -rf node_modules

# 重新安装
npm install
```

### 3. PM2 进程不存在
如果 PM2 没有运行：
```bash
# 启动应用
pm2 start npm --name shenghaiquan -- start

# 保存 PM2 配置
pm2 save
pm2 startup
```

## 自动部署设置

为了避免以后手动更新，可以设置 GitHub Webhook：

1. 在 GitHub 仓库设置中添加 Webhook
2. URL: `http://111.231.19.162:3000/api/deploy`
3. 选择 Push 事件

或者设置定时任务：
```bash
# 编辑 crontab
crontab -e

# 每小时检查更新
0 * * * * cd /www/wwwroot/深海圈网站 && git pull origin main && npm run build && pm2 restart shenghaiquan
```