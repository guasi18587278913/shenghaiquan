# 深海圈课程导入详细步骤指南

## 第一步：建立数据库连接

### 1.1 打开终端（Terminal）
- Mac: 按 `Command + 空格`，输入 "Terminal" 打开
- 在终端中，确保您在项目目录：
```bash
cd /Users/liyadong/Documents/GitHub/深海圈网站
```

### 1.2 建立SSH隧道
在终端输入以下命令：
```bash
ssh -f -N -L 5433:localhost:5432 root@111.231.19.162
```

**输入密码时的注意事项：**
- 系统会提示输入密码
- 输入密码时屏幕不会显示任何字符（这是正常的）
- 输入完成后按回车
- 如果成功，不会有任何提示，直接返回命令行

### 1.3 验证连接是否成功
输入以下命令检查：
```bash
ps aux | grep ssh | grep 5433
```
如果看到类似这样的输出，说明隧道建立成功：
```
liyadong  12345  ... ssh -f -N -L 5433:localhost:5432 root@111.231.19.162
```

## 第二步：更新数据库结构

### 2.1 设置环境变量并运行迁移
在终端中依次执行：
```bash
# 设置数据库连接
export DATABASE_URL="postgresql://guasi:Scys-0418@localhost:5433/deepsea"

# 生成Prisma客户端
npx prisma generate

# 运行数据库迁移
npx prisma migrate dev --name add_course_system
```

**可能遇到的情况：**
- 如果提示 "Are you sure you want to create..."，输入 `y` 并回车
- 如果成功，会看到 "The following migration(s) have been applied..."

## 第三步：查看和编辑课程模板

### 3.1 查看模板文件
在 Finder 中打开项目文件夹，找到：
```
深海圈网站
└── scripts
    └── course-import-template.json
```

### 3.2 使用文本编辑器打开
- 右键点击 `course-import-template.json`
- 选择 "打开方式" → "文本编辑" 或 VS Code

### 3.3 理解模板结构
模板包含两个主要部分：

#### A. 课程结构（sections）
```json
{
  "sections": [
    {
      "title": "前言",        // 篇章名称
      "slug": "preface",      // URL标识（不要改）
      "courses": [            // 这个篇章下的课程列表
        {
          "title": "欢迎来到深海圈",  // 课程名称
          "chapters": [               // 章节列表
            {
              "title": "第1章：为什么创建深海圈",
              "lessons": [            // 课时列表
                {
                  "title": "1.1 创始人的话",
                  "type": "VIDEO_TEXT",  // 类型：VIDEO_TEXT 或 TEXT_ONLY
                  "content": "这里填写课程文稿",
                  "videoId": "",         // 腾讯云视频ID（暂时留空）
                  "videoDuration": 0     // 视频时长（秒）
                }
              ]
            }
          ]
        }
      ]
    }
  ]
}
```

#### B. 直播回放（liveReplays）
```json
{
  "liveReplays": [
    {
      "title": "如何选择AI产品方向",
      "category": "product-selection",  // 分类
      "videoId": "",                   // 腾讯云视频ID
      "videoDuration": 0,              // 时长（秒）
      "liveDate": "2025-01-20",        // 直播日期
      "presenter": "深海圈创始人"       // 主讲人
    }
  ]
}
```

## 第四步：填写您的课程内容

### 4.1 填写文本内容
将您准备好的课程文稿复制粘贴到 `content` 字段中。

**Markdown格式示例：**
```markdown
# 课程标题

## 主要内容

这是一段普通文字。

### 重点知识

- 要点1
- 要点2
- 要点3

**重要提示：** 这是加粗文字

`代码示例`
```

### 4.2 关于视频ID
现在先把 `videoId` 留空（""），视频时长 `videoDuration` 设为 0。
等后续集成腾讯云点播后再更新。

### 4.3 课程类型选择
- `VIDEO_TEXT`: 有视频+文字的课程
- `TEXT_ONLY`: 只有文字的课程

### 4.4 免费/付费设置
- `isFree: true`: 免费课程
- `isFree: false`: 付费课程（年度会员）

## 第五步：保存并导入数据

### 5.1 保存文件
编辑完成后，保存 `course-import-template.json` 文件。

### 5.2 运行导入命令
回到终端，执行：
```bash
npm run import-courses
```

### 5.3 查看导入结果
成功后会看到类似输出：
```
开始导入课程数据...
✓ 创建篇章：前言
  ✓ 创建课程：欢迎来到深海圈
    ✓ 创建章节：第1章：为什么创建深海圈
      ✓ 创建课时：1.1 创始人的话

✅ 课程数据导入完成！

📊 导入统计：
- 篇章数：5
- 课程数：1
- 章节数：1
- 课时数：1
- 直播回放数：1
```

## 第六步：验证导入结果

### 6.1 启动开发服务器
```bash
npm run dev
```

### 6.2 访问网站
打开浏览器，访问 http://localhost:3000

### 6.3 查看课程页面
导航到课程页面，应该能看到您导入的课程内容。

## 常见问题解答

### Q1: SSH连接失败怎么办？
**A:** 检查：
1. 服务器IP是否正确（111.231.19.162）
2. 密码是否正确
3. 网络是否正常

### Q2: 数据库迁移失败？
**A:** 可能是SSH隧道断开了，重新执行步骤1.2

### Q3: 导入后看不到课程？
**A:** 检查：
1. 导入时是否有错误提示
2. `isPublished` 是否设置为 true
3. 刷新浏览器缓存（Command + Shift + R）

### Q4: 如何修改已导入的课程？
**A:** 两种方式：
1. 清空数据重新导入
2. 直接在数据库中修改（需要SQL知识）

### Q5: 可以分批导入吗？
**A:** 可以！您可以：
1. 先导入部分课程测试
2. 确认没问题后再导入其余课程
3. 每次导入都会添加新内容，不会覆盖已有数据

## 下一步计划

1. **完善课程内容**：继续添加更多章节和课时
2. **集成腾讯云点播**：上传视频并更新videoId
3. **实现播放页面**：开发视频播放和内容保护功能
4. **添加学习进度**：跟踪用户学习情况

## 需要帮助？

如果在任何步骤遇到问题，请：
1. 截图错误信息
2. 告诉我您在哪一步遇到困难
3. 我会针对性地帮您解决