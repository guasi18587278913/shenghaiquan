# 宝塔面板 - 深海圈网站检查命令

## 一、基础检查（先运行这个）

```bash
pwd
```

## 二、进入网站目录

```bash
cd /www/wwwroot
ls
```

## 三、进入项目目录（根据实际文件夹名选择）

```bash
# 如果文件夹叫"深海圈网站"
cd 深海圈网站

# 如果文件夹叫"shenghaiquan"
cd shenghaiquan

# 如果是其他名字，用实际看到的名字
cd 实际文件夹名
```

## 四、一键快速检查脚本（重要！）

```bash
echo "====== 深海圈网站状态检查 ======"
echo ""
echo "1. 当前目录："
pwd
echo ""
echo "2. 项目文件："
ls -la | head -20
echo ""
echo "3. Node.js版本："
node -v 2>/dev/null || echo "❌ Node.js未安装"
echo ""
echo "4. PM2状态："
pm2 list 2>/dev/null || echo "❌ PM2未安装或没有运行的进程"
echo ""
echo "5. 环境文件："
if [ -f ".env" ]; then
    echo "✅ .env 文件存在"
elif [ -f ".env.production" ]; then
    echo "✅ .env.production 文件存在"
else
    echo "❌ 环境文件不存在"
fi
echo ""
echo "6. 构建目录："
if [ -d ".next" ]; then
    echo "✅ 项目已构建"
else
    echo "❌ 项目未构建"
fi
echo "====== 检查完成 ======"
```

## 五、详细检查命令

### 5.1 检查环境变量内容

```bash
# 查看环境变量文件
cat .env
```

或

```bash
cat .env.production
```

### 5.2 检查PM2进程详情

```bash
# 查看PM2列表
pm2 list

# 查看PM2日志
pm2 logs --lines 30
```

### 5.3 检查端口占用

```bash
# 查看3000端口
netstat -tlnp | grep 3000

# 查看8888端口
netstat -tlnp | grep 8888
```

### 5.4 测试网站是否运行

```bash
# 测试本地访问
curl http://localhost:3000 | head -20
```

## 六、常见问题修复命令

### 6.1 如果PM2没有进程

```bash
# 启动项目
pm2 start npm --name shenghaiquan -- start
```

### 6.2 如果项目没有构建

```bash
# 安装依赖
npm install

# 构建项目
npm run build
```

### 6.3 如果缺少环境变量文件

```bash
# 创建环境变量文件
cat > .env << EOF
DATABASE_URL="postgresql://postgres:password@localhost:5432/shenghaiquan"
NEXTAUTH_URL="http://111.231.19.162:8888"
NEXTAUTH_SECRET="your-secret-key-here"
EOF
```

### 6.4 重启应用

```bash
# 重启PM2进程
pm2 restart shenghaiquan

# 如果没有进程，先启动
pm2 start npm --name shenghaiquan -- start
```

## 七、宝塔面板专用检查

### 7.1 检查宝塔安装的软件

```bash
# 查看已安装的软件版本
/www/server/panel/pyenv/bin/python /www/server/panel/class/panelPlugin.py
```

### 7.2 检查网站配置

```bash
# 查看网站配置文件
cat /www/server/panel/vhost/nginx/*.conf | grep -A 10 "111.231.19.162"
```

## 八、完整部署流程（如果需要重新部署）

```bash
# 1. 进入项目目录
cd /www/wwwroot/深海圈网站

# 2. 拉取最新代码
git pull origin main

# 3. 安装依赖
npm install

# 4. 创建环境变量文件（如果不存在）
cp .env.example .env

# 5. 编辑环境变量
nano .env
# 或使用宝塔面板的文件管理器编辑

# 6. 构建项目
npm run build

# 7. 使用PM2启动
pm2 start npm --name shenghaiquan -- start

# 8. 保存PM2配置
pm2 save
pm2 startup
```

## 九、查看运行状态

```bash
# 查看PM2状态
pm2 status

# 查看应用信息
pm2 info shenghaiquan

# 实时查看日志
pm2 logs shenghaiquan
```

## 十、测试访问

```bash
# 在终端测试
curl -I http://localhost:3000

# 查看返回状态
# 应该看到 HTTP/1.1 200 OK
```

---

## 使用说明

1. **按顺序执行**：从第一部分开始，按顺序执行命令
2. **注意返回结果**：每个命令执行后，注意查看返回的结果
3. **遇到错误**：如果某个命令报错，记下错误信息
4. **最重要的**：先运行第四部分的"一键快速检查脚本"

## 需要记录的信息

运行检查后，请告诉我：
- [ ] 项目在哪个目录？
- [ ] Node.js 版本是多少？
- [ ] PM2 有运行的进程吗？
- [ ] 环境文件存在吗？
- [ ] 项目已经构建了吗？
- [ ] 有什么错误信息？

有了这些信息，我就能准确地告诉你下一步该做什么！