# 课程内容上传方案

## 一、内容存储架构

### 1. 文稿内容
- **存储位置**：PostgreSQL数据库
- **存储方式**：Markdown格式文本
- **上传方式**：通过管理后台或API

### 2. 视频内容
- **方案A：腾讯云COS/VOD**（推荐）
  - 视频文件存储在腾讯云
  - 数据库只存储视频URL
  - 支持视频流播放、转码、加密

- **方案B：服务器本地存储**（不推荐）
  - 占用服务器空间
  - 带宽压力大
  - 不支持高级功能

## 二、上传流程（推荐方案）

### 第1步：准备课程数据文件

创建课程数据JSON文件：`/data/courses/my-courses.json`

```json
{
  "courses": [
    {
      "title": "10分钟搞定产品雏形",
      "description": "用AI工具快速实现你的第一个MVP",
      "instructor": "刘小排",
      "price": 299,
      "chapters": [
        {
          "title": "第1章：课程介绍",
          "description": "了解课程内容和学习目标",
          "videoUrl": "https://your-video-url.mp4",
          "duration": 600,
          "content": "# 第1章：课程介绍\n\n## 学习目标\n\n这里是Markdown格式的课程文稿..."
        }
      ]
    }
  ]
}
```

### 第2步：创建导入脚本

创建 `scripts/import-my-courses.js`：

```javascript
const { PrismaClient } = require('@prisma/client');
const fs = require('fs');
const path = require('path');

const prisma = new PrismaClient();

async function importCourses() {
  try {
    // 读取课程数据
    const data = JSON.parse(
      fs.readFileSync(path.join(__dirname, '../data/courses/my-courses.json'), 'utf-8')
    );

    // 找到讲师
    const instructor = await prisma.user.findFirst({
      where: { name: '刘小排' }
    });

    if (!instructor) {
      console.error('未找到讲师用户');
      return;
    }

    // 导入课程
    for (const courseData of data.courses) {
      const course = await prisma.course.create({
        data: {
          title: courseData.title,
          description: courseData.description,
          instructorId: instructor.id,
          price: courseData.price,
          level: 'BEGINNER',
          category: 'AI_PRODUCT',
          published: true,
          chapters: {
            create: courseData.chapters.map((chapter, index) => ({
              title: chapter.title,
              description: chapter.description,
              content: chapter.content,
              videoUrl: chapter.videoUrl,
              duration: chapter.duration,
              order: index + 1,
              published: true
            }))
          }
        }
      });

      console.log(`✅ 导入课程：${course.title}`);
    }

    console.log('所有课程导入完成！');
  } catch (error) {
    console.error('导入失败:', error);
  } finally {
    await prisma.$disconnect();
  }
}

importCourses();
```

### 第3步：上传视频到腾讯云

1. **开通腾讯云VOD服务**
2. **获取上传凭证**
3. **使用VOD上传工具上传视频**
4. **获取视频播放URL**

### 第4步：执行导入

```bash
# 本地测试
node scripts/import-my-courses.js

# 服务器执行
# 1. 先提交代码到GitHub
git add .
git commit -m "添加课程数据"
git push origin main

# 2. 在服务器上执行
cd /www/wwwroot/deepsea
node scripts/import-my-courses.js
```

## 三、简化方案：先用外部视频链接

如果暂时不想配置腾讯云VOD，可以：

1. **使用B站/YouTube视频**
   - 上传视频到B站
   - 获取嵌入代码
   - 在videoUrl字段存储B站视频ID

2. **修改播放器组件支持B站**：
```jsx
// 支持B站视频
if (videoUrl.includes('bilibili')) {
  return <iframe src={`//player.bilibili.com/player.html?bvid=${videoUrl}`} />
}
```

## 四、管理后台方案（后续开发）

1. **开发课程管理页面**
   - `/admin/courses` - 课程列表
   - `/admin/courses/create` - 创建课程
   - `/admin/courses/[id]/edit` - 编辑课程

2. **功能包括**：
   - 富文本编辑器（编辑课程文稿）
   - 视频上传组件
   - 章节管理
   - 发布/下架控制

## 五、立即可行的方案

1. **准备课程数据**：整理成JSON格式
2. **使用脚本导入**：通过命令行导入数据库
3. **视频暂用外链**：B站、腾讯视频等
4. **后续再优化**：开发管理后台

需要我帮你创建导入脚本吗？