# 课程系统实现方案

## 一、数据存储设计

### 1. 数据库设计（已有模型）

```prisma
// Course 模型 - 课程
model Course {
  id            String    @id @default(cuid())
  title         String    // 课程标题
  description   String    // 课程描述
  cover         String?   // 封面图URL
  category      CourseCategory
  level         CourseLevel
  price         Float     @default(0)
  isPaid        Boolean   @default(false)
  isPublished   Boolean   @default(false)
  order         Int       @default(0)
  chapters      Chapter[] // 章节列表
}

// Chapter 模型 - 章节
model Chapter {
  id            String    @id @default(cuid())
  courseId      String
  course        Course    @relation(fields: [courseId], references: [id])
  title         String    // 章节标题
  description   String?   // 章节描述
  content       String    // Markdown文字内容
  videoUrl      String?   // 视频URL
  duration      Int?      // 视频时长（秒）
  order         Int       @default(0)
  isLocked      Boolean   @default(true)
}
```

### 2. 视频存储方案

#### 方案A：阿里云OSS（推荐）

**实施步骤：**
1. 开通阿里云OSS服务
2. 创建Bucket（建议：deep-sea-videos）
3. 配置跨域CORS
4. 上传视频获取URL
5. 配置CDN加速（可选）

**集成代码示例：**
```javascript
// lib/aliyun-oss.ts
import OSS from 'ali-oss'

const client = new OSS({
  region: 'oss-cn-hangzhou',
  accessKeyId: process.env.ALIYUN_ACCESS_KEY_ID,
  accessKeySecret: process.env.ALIYUN_ACCESS_KEY_SECRET,
  bucket: 'deep-sea-videos'
})

export async function uploadVideo(file: File) {
  const fileName = `courses/${Date.now()}-${file.name}`
  const result = await client.put(fileName, file)
  return result.url
}
```

#### 方案B：使用免费视频平台

**B站/YouTube（适合公开课程）：**
- 上传视频到平台
- 获取嵌入代码
- 存储视频ID到数据库

**实现示例：**
```javascript
// 存储B站视频
videoUrl: "bilibili:BV1xx411c7mD" // 存储视频ID

// 播放器组件解析
function VideoPlayer({ videoUrl }) {
  if (videoUrl.startsWith('bilibili:')) {
    const bvid = videoUrl.split(':')[1]
    return (
      <iframe 
        src={`//player.bilibili.com/player.html?bvid=${bvid}`}
        width="100%" 
        height="600"
      />
    )
  }
  // 其他平台...
}
```

## 二、功能实现计划

### 第一阶段：基础功能（3天）

#### Day 1：数据导入
- [ ] 创建课程导入脚本
- [ ] 将16万字内容结构化
- [ ] 导入到数据库

#### Day 2：课程展示
- [ ] 课程列表页面
- [ ] 课程详情页面
- [ ] 章节列表展示

#### Day 3：视频播放
- [ ] 集成视频播放器
- [ ] 实现进度记录
- [ ] 添加播放控制

### 第二阶段：进阶功能（2天）

#### Day 4：学习追踪
- [ ] 学习进度统计
- [ ] 完成状态标记
- [ ] 学习时长记录

#### Day 5：优化体验
- [ ] 笔记功能
- [ ] 收藏章节
- [ ] 快捷导航

## 三、技术选型

### 1. 视频播放器

**Video.js（推荐）**
```bash
npm install video.js @videojs/themes
```

优点：
- 开源免费
- 功能完整
- 支持HLS/DASH
- 可定制皮肤

### 2. Markdown渲染

**MDX + Remark**
```bash
npm install @next/mdx remark remark-html
```

优点：
- 支持React组件
- 语法高亮
- 可扩展

### 3. 进度存储

使用现有的 `Progress` 模型：
- 记录观看进度
- 保存最后位置
- 统计学习时长

## 四、成本估算

### OSS存储成本（100GB视频）
- 存储费：12元/月
- CDN流量：按实际使用（约0.24元/GB）
- 总计：约50-200元/月（取决于观看量）

### 免费方案
- 使用B站/YouTube：完全免费
- 使用Cloudflare R2：仅存储费用

## 五、实施建议

### 立即可做：
1. **整理课程内容**
   - 将16万字拆分成章节
   - 准备章节标题和描述
   - 标记对应的视频文件

2. **选择视频方案**
   - 预算充足：阿里云OSS
   - 预算有限：B站/YouTube
   - 技术探索：Cloudflare R2

3. **创建导入脚本**
   - 解析课程内容
   - 批量导入数据库
   - 生成章节结构

### 示例数据结构：
```json
{
  "title": "AI产品出海完全指南",
  "description": "从0到1打造AI产品并成功出海",
  "chapters": [
    {
      "title": "第1章：AI产品出海概述",
      "content": "# 为什么要做AI产品出海\n\n...",
      "videoUrl": "https://oss.deep-sea.com/chapter1.mp4",
      "duration": 1200
    }
  ]
}
```

## 六、下一步行动

1. **确认视频存储方案**
2. **整理第一个课程的内容**
3. **开始实现课程列表页面**

需要我帮您实现哪个部分？