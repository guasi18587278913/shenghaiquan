# æ·±æµ·åœˆæ•™å­¦è§†é¢‘ä¸Šä¼ å®Œæ•´æ–¹æ¡ˆ

## ğŸ“‹ æ–¹æ¡ˆæ¦‚è¿°

æœ¬æ–¹æ¡ˆæä¾›ä¸‰ç§è§†é¢‘ä¸Šä¼ æ–¹å¼ï¼ŒæŒ‰æ¨èç¨‹åº¦æ’åºï¼š
1. **è…¾è®¯äº‘ç‚¹æ’­ï¼ˆæ¨èï¼‰** - ä¸“ä¸šè§†é¢‘è§£å†³æ–¹æ¡ˆ
2. **è…¾è®¯äº‘COSå­˜å‚¨** - ç®€å•ç›´æ¥
3. **æœ¬åœ°å­˜å‚¨** - å¼€å‘æµ‹è¯•ä½¿ç”¨

## ğŸš€ æ–¹æ¡ˆä¸€ï¼šè…¾è®¯äº‘ç‚¹æ’­ï¼ˆVODï¼‰ã€æ¨èã€‘

### ä¼˜åŠ¿
- âœ… è‡ªåŠ¨è½¬ç ï¼Œæ”¯æŒå¤šç§æ¸…æ™°åº¦
- âœ… é˜²ç›—é“¾ä¿æŠ¤
- âœ… æµç•…æ’­æ”¾ï¼ŒCDNåŠ é€Ÿ
- âœ… æ”¯æŒå¤§æ–‡ä»¶ä¸Šä¼ ï¼ˆæœ€å¤§48.82GBï¼‰
- âœ… è‡ªåŠ¨ç”Ÿæˆè§†é¢‘å°é¢

### é…ç½®æ­¥éª¤

#### 1. å¼€é€šè…¾è®¯äº‘ç‚¹æ’­æœåŠ¡
```bash
1. ç™»å½•è…¾è®¯äº‘æ§åˆ¶å°
2. æœç´¢"äº‘ç‚¹æ’­VOD"
3. å¼€é€šæœåŠ¡ï¼ˆæ–°ç”¨æˆ·æœ‰å…è´¹é¢åº¦ï¼‰
4. è·å–SecretIdå’ŒSecretKey
```

#### 2. é…ç½®ç¯å¢ƒå˜é‡
åœ¨ `.env.local` ä¸­æ·»åŠ ï¼š
```env
# è…¾è®¯äº‘VODé…ç½®
VOD_SECRET_ID=ä½ çš„SecretId
VOD_SECRET_KEY=ä½ çš„SecretKey
VOD_APP_ID=ä½ çš„AppId
```

#### 3. å®‰è£…VOD SDK
```bash
npm install vod-node-sdk
```

#### 4. åˆ›å»ºè§†é¢‘ä¸Šä¼ é¡µé¢
åœ¨ `/app/admin/courses/video-upload/page.tsx`ï¼š

```typescript
'use client';

import { useState } from 'react';
import { Upload, Video, Loader2 } from 'lucide-react';

export default function VideoUploadPage() {
  const [uploading, setUploading] = useState(false);
  const [progress, setProgress] = useState(0);
  const [videoUrl, setVideoUrl] = useState('');

  const handleUpload = async (file: File) => {
    setUploading(true);
    
    try {
      // 1. è·å–ä¸Šä¼ ç­¾å
      const signRes = await fetch('/api/vod/signature');
      const { signature } = await signRes.json();
      
      // 2. ä½¿ç”¨è…¾è®¯äº‘SDKä¸Šä¼ 
      const VodUploader = (await import('vod-js-sdk-v6')).default;
      
      const uploader = new VodUploader({
        getSignature: () => signature
      });
      
      const result = await uploader.upload({
        mediaFile: file,
        onProgress: (info) => {
          setProgress(Math.floor(info.percent * 100));
        }
      });
      
      setVideoUrl(result.video.url);
      
      // 3. ä¿å­˜åˆ°æ•°æ®åº“
      await fetch('/api/courses/video', {
        method: 'POST',
        body: JSON.stringify({
          fileId: result.fileId,
          url: result.video.url,
          name: file.name,
          size: file.size,
          duration: result.video.duration
        })
      });
      
    } catch (error) {
      console.error('ä¸Šä¼ å¤±è´¥:', error);
    } finally {
      setUploading(false);
    }
  };

  return (
    <div className="max-w-4xl mx-auto p-6">
      <h1 className="text-2xl font-bold mb-6">ä¸Šä¼ æ•™å­¦è§†é¢‘</h1>
      
      <div className="bg-white rounded-lg shadow p-6">
        <input
          type="file"
          accept="video/*"
          onChange={(e) => e.target.files?.[0] && handleUpload(e.target.files[0])}
          className="hidden"
          id="video-upload"
        />
        
        <label htmlFor="video-upload" className="block cursor-pointer">
          <div className="border-2 border-dashed border-gray-300 rounded-lg p-12 text-center hover:border-blue-500 transition">
            {uploading ? (
              <>
                <Loader2 className="w-12 h-12 mx-auto mb-4 animate-spin text-blue-500" />
                <p>ä¸Šä¼ ä¸­... {progress}%</p>
              </>
            ) : (
              <>
                <Upload className="w-12 h-12 mx-auto mb-4 text-gray-400" />
                <p className="text-lg">ç‚¹å‡»æˆ–æ‹–æ‹½è§†é¢‘æ–‡ä»¶åˆ°æ­¤å¤„</p>
                <p className="text-sm text-gray-500 mt-2">æ”¯æŒ MP4, MOV, AVI ç­‰æ ¼å¼ï¼Œæœ€å¤§ 5GB</p>
              </>
            )}
          </div>
        </label>
        
        {videoUrl && (
          <div className="mt-6">
            <h3 className="font-semibold mb-2">ä¸Šä¼ æˆåŠŸï¼</h3>
            <video controls className="w-full rounded" src={videoUrl} />
            <input 
              type="text" 
              value={videoUrl} 
              readOnly 
              className="w-full mt-2 p-2 border rounded bg-gray-50"
            />
          </div>
        )}
      </div>
    </div>
  );
}
```

## ğŸ¯ æ–¹æ¡ˆäºŒï¼šè…¾è®¯äº‘COSå­˜å‚¨

### ä¼˜åŠ¿
- âœ… é…ç½®ç®€å•
- âœ… æˆæœ¬è¾ƒä½
- âœ… é€‚åˆä¸­å°å‹è§†é¢‘

### é…ç½®æ­¥éª¤

#### 1. å¼€é€šCOSæœåŠ¡
```bash
1. ç™»å½•è…¾è®¯äº‘æ§åˆ¶å°
2. åˆ›å»ºå­˜å‚¨æ¡¶ï¼ˆé€‰æ‹©å…¬æœ‰è¯»ç§æœ‰å†™ï¼‰
3. è·å–SecretIdã€SecretKeyå’ŒBucketä¿¡æ¯
```

#### 2. æ›´æ–°ä¸Šä¼ æ¥å£
ä¿®æ”¹ `/app/api/upload/video/route.ts`ï¼š

```typescript
import COS from 'cos-nodejs-sdk-v5';

const cos = new COS({
  SecretId: process.env.COS_SECRET_ID,
  SecretKey: process.env.COS_SECRET_KEY,
});

export async function POST(request: NextRequest) {
  // ... éªŒè¯ä»£ç  ...
  
  const result = await cos.putObject({
    Bucket: process.env.COS_BUCKET,
    Region: process.env.COS_REGION,
    Key: `videos/${fileName}`,
    Body: buffer,
  });
  
  const videoUrl = `https://${process.env.COS_BUCKET}.cos.${process.env.COS_REGION}.myqcloud.com/videos/${fileName}`;
  
  return NextResponse.json({
    success: true,
    data: { url: videoUrl }
  });
}
```

## ğŸ’¾ æ–¹æ¡ˆä¸‰ï¼šæœ¬åœ°å­˜å‚¨ï¼ˆä»…å¼€å‘ä½¿ç”¨ï¼‰

### å½“å‰å·²å®ç°çš„åŠŸèƒ½
- æ”¯æŒæ ¼å¼ï¼šMP4, WebM, OGG, MOV, AVI
- æœ€å¤§æ–‡ä»¶ï¼š500MB
- å­˜å‚¨ä½ç½®ï¼š`/public/uploads/videos/`

### ä½¿ç”¨æ–¹æ³•
```javascript
const formData = new FormData();
formData.append('file', videoFile);

const response = await fetch('/api/upload/video', {
  method: 'POST',
  body: formData
});
```

## ğŸ“š å°†è§†é¢‘å…³è”åˆ°è¯¾ç¨‹

### 1. æ›´æ–°è¯¾ç¨‹æ•°æ®ç»“æ„
ä¿®æ”¹ `/lib/course-data.ts`ï¼š

```typescript
export interface Lesson {
  id: string;
  title: string;
  slug: string;
  type: 'video' | 'article' | 'wordpress' | 'quiz';
  content?: string;
  videoUrl?: string;        // è§†é¢‘URL
  videoDuration?: number;   // è§†é¢‘æ—¶é•¿ï¼ˆç§’ï¼‰
  videoFileId?: string;     // VODæ–‡ä»¶ID
  // ...
}
```

### 2. åœ¨è¯¾ç¨‹ç®¡ç†é¡µé¢æ·»åŠ è§†é¢‘
åˆ›å»º `/app/admin/courses/[sectionSlug]/[lessonSlug]/edit/page.tsx`

### 3. è§†é¢‘æ’­æ”¾å™¨é›†æˆ
æ¨èä½¿ç”¨ Video.jsï¼š

```bash
npm install video.js @videojs/themes
```

åœ¨è¯¾ç¨‹è¯¦æƒ…é¡µä½¿ç”¨ï¼š
```jsx
import videojs from 'video.js';
import 'video.js/dist/video-js.css';
import '@videojs/themes/dist/sea/index.css';

<video
  ref={videoRef}
  className="video-js vjs-theme-sea vjs-big-play-centered"
  controls
  preload="auto"
>
  <source src={lesson.videoUrl} type="video/mp4" />
</video>
```

## ğŸ”§ å®æ–½æ­¥éª¤

### ç¬¬ä¸€æ­¥ï¼šé€‰æ‹©æ–¹æ¡ˆ
- ç”Ÿäº§ç¯å¢ƒï¼šä½¿ç”¨è…¾è®¯äº‘VOD
- æµ‹è¯•ç¯å¢ƒï¼šä½¿ç”¨æœ¬åœ°å­˜å‚¨

### ç¬¬äºŒæ­¥ï¼šé…ç½®æœåŠ¡
1. ç”³è¯·è…¾è®¯äº‘è´¦å·
2. å¼€é€šVODæœåŠ¡
3. é…ç½®ç¯å¢ƒå˜é‡

### ç¬¬ä¸‰æ­¥ï¼šå®ç°ä¸Šä¼ åŠŸèƒ½
1. åˆ›å»ºä¸Šä¼ é¡µé¢
2. å®ç°è¿›åº¦æ˜¾ç¤º
3. æ·»åŠ é”™è¯¯å¤„ç†

### ç¬¬å››æ­¥ï¼šå…³è”è¯¾ç¨‹
1. æ›´æ–°è¯¾ç¨‹æ•°æ®æ¨¡å‹
2. åˆ›å»ºè§†é¢‘é€‰æ‹©å™¨
3. å®ç°æ’­æ”¾åŠŸèƒ½

## ğŸ’¡ æœ€ä½³å®è·µ

1. **è§†é¢‘å‹ç¼©**
   - ä¸Šä¼ å‰ä½¿ç”¨ FFmpeg å‹ç¼©
   - æ¨èç ç‡ï¼š1080p çº¦ 3Mbps

2. **ç”¨æˆ·ä½“éªŒ**
   - æ˜¾ç¤ºä¸Šä¼ è¿›åº¦
   - æ”¯æŒæ–­ç‚¹ç»­ä¼ 
   - æä¾›é¢„è§ˆåŠŸèƒ½

3. **å®‰å…¨è€ƒè™‘**
   - é™åˆ¶æ–‡ä»¶ç±»å‹
   - è®¾ç½®æœ€å¤§æ–‡ä»¶å¤§å°
   - ä½¿ç”¨é˜²ç›—é“¾

4. **æ€§èƒ½ä¼˜åŒ–**
   - ä½¿ç”¨CDNåŠ é€Ÿ
   - å®ç°æ‡’åŠ è½½
   - æ”¯æŒå¤šæ¸…æ™°åº¦åˆ‡æ¢

## ğŸš¨ æ³¨æ„äº‹é¡¹

1. **æˆæœ¬æ§åˆ¶**
   - VODæŒ‰ä½¿ç”¨é‡è®¡è´¹
   - å»ºè®®è®¾ç½®ç”¨é‡å‘Šè­¦
   - å®šæœŸæ¸…ç†æ— ç”¨è§†é¢‘

2. **å¤‡ä»½ç­–ç•¥**
   - é‡è¦è§†é¢‘å¤šåœ°å¤‡ä»½
   - å®šæœŸå¯¼å‡ºè§†é¢‘åˆ—è¡¨
   - ä¿ç•™åŸå§‹æ–‡ä»¶

3. **åˆè§„è¦æ±‚**
   - è§†é¢‘å†…å®¹å®¡æ ¸
   - ç‰ˆæƒä¿æŠ¤æªæ–½
   - ç”¨æˆ·éšç§ä¿æŠ¤

éœ€è¦æˆ‘å¸®æ‚¨å®ç°å…·ä½“å“ªä¸ªæ–¹æ¡ˆå—ï¼Ÿ