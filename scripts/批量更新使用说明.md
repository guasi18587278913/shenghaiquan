# 批量更新用户数据使用说明

## 功能介绍

`batch-update-users.js` 脚本用于批量更新用户数据，支持从CSV或JSON文件导入数据，灵活更新指定字段。

## 使用方法

### 1. 准备数据文件

支持两种格式：

#### JSON格式示例
```json
[
  {
    "name": "用户名",
    "bio": "个人简介",
    "company": "公司名称",
    "position": "职位",
    "skills": "技能1,技能2,技能3",
    "location": "城市",
    "avatar": "https://头像URL"
  }
]
```

#### CSV格式示例
```csv
name,bio,company,position,skills,location
张三,产品经理，10年经验,互联网公司,产品总监,产品设计,数据分析,用户研究,北京
李四,全栈工程师,创业公司,技术负责人,React,Node.js,TypeScript,上海
```

### 2. 运行脚本

基本用法：
```bash
node scripts/batch-update-users.js <数据文件路径>
```

### 3. 可选参数

- **--dry-run**: 预览模式，只显示将要更新的内容，不实际执行
- **--fields=字段列表**: 指定要更新的字段（逗号分隔）
- **--match-by=匹配字段**: 指定匹配用户的字段（默认为name，也可以用phone）

### 4. 使用示例

#### 预览更新（不实际执行）
```bash
node scripts/batch-update-users.js scripts/update-example.json --dry-run
```

#### 只更新bio和skills字段
```bash
node scripts/batch-update-users.js data/updates.json --fields=bio,skills
```

#### 通过手机号匹配用户
```bash
node scripts/batch-update-users.js data/updates.csv --match-by=phone
```

#### 完整更新示例
```bash
node scripts/batch-update-users.js data/new-user-info.json --fields=bio,company,position,skills
```

### 5. 注意事项

1. **数据验证**：脚本会自动过滤以下内容
   - 空值和"无"
   - 默认值（如"互联网行业"、"企业员工/创业公司员工"）
   - 无效的URL（avatar字段）

2. **字段限制**：
   - skills最多保留5个标签
   - 所有文本字段会自动trim去除首尾空格

3. **匹配规则**：
   - 默认通过name字段匹配
   - 可以改为通过phone字段匹配
   - 匹配不到的用户会跳过

4. **报告生成**：
   - 每次运行会生成详细报告文件
   - 报告包含所有更新详情和统计信息

### 6. 批量更新流程

1. 收集需要更新的用户数据
2. 整理成JSON或CSV格式
3. 先用 `--dry-run` 预览
4. 确认无误后执行实际更新
5. 查看生成的报告确认更新结果

### 7. 常见问题

**Q: 如何更新用户的技能标签？**
A: 在skills字段中用逗号分隔多个技能，如："React,Node.js,TypeScript"

**Q: 如何清空某个字段？**
A: 目前脚本不支持清空字段，只能更新为新值

**Q: 更新失败怎么办？**
A: 查看生成的报告文件，里面有详细的错误信息

**Q: 可以撤销更新吗？**
A: 不能自动撤销，建议先用 --dry-run 预览，或者提前备份数据库